<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Wallet - Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="navbar">
        <div class="navbar-container">
            <h1 class="navbar-brand">E-Wallet</h1>
            <div class="navbar-menu">
                <button id="logoutBtn" class="btn btn-secondary">Logout</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="dashboard">
            <!-- User Info -->
            <div class="card">
                <h2>Welcome, <span id="userName">User</span></h2>
                <p>Email: <span id="userEmail">-</span></p>
            </div>

            <!-- Wallet Balance -->
            <div class="card balance-card">
                <h3>Wallet Balance</h3>
                <p class="balance-amount">$<span id="balance">0.00</span></p>
                <p class="balance-label">Available Balance</p>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <h3>Quick Actions</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="showModal('topupModal')">Top-up</button>
                    <button class="btn btn-primary" onclick="showModal('withdrawModal')">Withdraw</button>
                    <button class="btn btn-primary" onclick="goToTransactions()">Transactions</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Top-up Modal -->
    <div id="topupModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('topupModal')">&times;</span>
            <h2>Top-up Wallet</h2>
            <form id="topupForm">
                <div class="form-group">
                    <label for="topupAmount">Amount ($)</label>
                    <input type="number" id="topupAmount" placeholder="Enter amount" min="0.01" step="0.01" required>
                </div>
                <button type="submit" class="btn btn-primary">Top-up</button>
            </form>
            <div id="topupMessage" class="message"></div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('withdrawModal')">&times;</span>
            <h2>Withdraw from Wallet</h2>
            <form id="withdrawForm">
                <div class="form-group">
                    <label for="withdrawAmount">Amount ($)</label>
                    <input type="number" id="withdrawAmount" placeholder="Enter amount" min="0.01" step="0.01" required>
                </div>
                <button type="submit" class="btn btn-primary">Withdraw</button>
            </form>
            <div id="withdrawMessage" class="message"></div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script>
        // Check authentication
        if (!localStorage.getItem('token')) {
            window.location.href = 'index.html';
        }

        // Initialize page
        document.getElementById('userName').textContent = localStorage.getItem('userName') || 'User';
        document.getElementById('userEmail').textContent = localStorage.getItem('userEmail') || '-';

        // Load wallet info
        loadWalletInfo();

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.clear();
            window.location.href = 'index.html';
        });

        // Top-up form
        document.getElementById('topupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('topupAmount').value);
            
            try {
                const response = await transactionAPI.topup(amount);
                
                if (response.success) {
                    showMessage('Top-up successful!', 'topupMessage', 'success');
                    document.getElementById('topupForm').reset();
                    loadWalletInfo();
                    setTimeout(() => closeModal('topupModal'), 1500);
                } else {
                    showMessage(response.message || 'Top-up failed', 'topupMessage', 'error');
                }
            } catch (error) {
                showMessage('Failed to process top-up: ' + error.message, 'topupMessage', 'error');
            }
        });

        // Withdraw form
        document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            
            try {
                const response = await transactionAPI.withdraw(amount);
                
                if (response.success) {
                    showMessage('Withdrawal successful!', 'withdrawMessage', 'success');
                    document.getElementById('withdrawForm').reset();
                    loadWalletInfo();
                    setTimeout(() => closeModal('withdrawModal'), 1500);
                } else {
                    showMessage(response.message || 'Withdrawal failed', 'withdrawMessage', 'error');
                }
            } catch (error) {
                showMessage('Failed to process withdrawal: ' + error.message, 'withdrawMessage', 'error');
            }
        });

        async function loadWalletInfo() {
            try {
                const response = await walletAPI.getWallet();
                if (response.success) {
                    document.getElementById('balance').textContent = response.data.balance.toFixed(2);
                }
            } catch (error) {
                console.error('Failed to load wallet info:', error);
            }
        }

        function goToTransactions() {
            window.location.href = 'transaction.html';
        }
    </script>
</body>
</html>
